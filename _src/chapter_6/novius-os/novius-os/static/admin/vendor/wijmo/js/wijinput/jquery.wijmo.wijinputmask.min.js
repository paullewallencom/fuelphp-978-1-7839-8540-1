var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(e){"use strict";var t=jQuery,n=function(n){function r(){n.apply(this,arguments),this._imMask=null,this._advanceMode=!1}return __extends(r,n),r._imMaskAssociatedoptions=["disabled","disableUserInput","blurOnLastChar","imeMode","blurOnLeftRightKey","tabAction","nullText","placeholder","readonly","promptChar","autoConvert","showNullText","hideEnter","hidePromptOnLeave","highlightText"],r.prototype._createTextProvider=function(){this._textProvider=new e.wijMaskedTextProvider(this,this.options.mask,!1)},r.prototype._checkMaskAndPassword=function(){var e=!this.options.mask||this.options.mask.length<0;if(e&&this._isPassword())throw'Option "passwordChar" requires a mask'},r.prototype._updateIsPassword=function(){var e=this.options.passwordChar.length>0&&this.element.attr("type")!=="password";this.element.data("isPassword",e),this._checkMaskAndPassword()},r.prototype._beginUpdate=function(){this.element.addClass(this.options.wijCSS.wijinputmask),this._updateIsPassword(),this.element.data("defaultText",this.options.text)},r.prototype._setOption=function(e,t){switch(e){case"maskFormat":this._super(e,t),e="mask"}n.prototype._setOption.call(this,e,t);if(this._advanceMode)if(r._imMaskAssociatedoptions.indexOf)r._imMaskAssociatedoptions.indexOf(e)!==-1&&this._syncProperties();else for(var i=0;i<r._imMaskAssociatedoptions.length;i++)if(r._imMaskAssociatedoptions[i]===e){this._syncProperties();break}switch(e){case"text":this._advanceMode&&this.options.textWithPromptAndLiterals&&(t=this.options.textWithPromptAndLiterals),this.setText(t);break;case"mask":case"culture":if(typeof t=="undefined"||t.length<=0)t="";this._checkMaskAndPassword();var s=this.getText();s===this._getNullText()&&(s=""),e==="mask"&&(this._textProvider.mask=t),this._checkFormatPattern(t),this._advanceMode?(this._imMask.SetText(s),this._updateText()):(this._textProvider.initialize(),this._textProvider.setText(s),this._updateText());break;case"promptChar":case"nullText":this._textProvider&&(this._textProvider.updatePromptChar(),this._updateText());break;case"hidePromptOnLeave":case"resetOnPrompt":this._updateText();break;case"passwordChar":this._updateIsPassword(),this._updateText()}},r.prototype._checkFormatPattern=function(t){if(t instanceof RegExp||this.options.formatMode==="advanced"){this._advanceMode||(this._detachInputEvent(),this._imMask||(this._imMask=new e.MaskControl,this._addimMaskCustomEvent()),this._imMask.AttachInput(this.element.get(0)),this._attachKeyEventForDropDownList(),this._advanceMode=!0);if(t instanceof RegExp){var r=t;this._imMask.SetFormatPattern(r.source)}else this._imMask.SetFormatPattern(t);this._syncProperties()}else this._advanceMode&&(this._imMask.DetachInput(),this._detachEventForDropDownList(),n.prototype._attachInputEvent.call(this)),this._advanceMode=!1},r.prototype._attachKeyEventForDropDownList=function(){this.element.bind({"keydown.wijinput":t.proxy(this._onKeyDownForDropDownList,this)})},r.prototype._detachEventForDropDownList=function(){this.element.unbind(".wijinput")},r.prototype._onKeyDownForDropDownList=function(e){n.prototype._processKeyForDropDownList.call(this,e)},r.prototype._syncProperties=function(){this._imMask.SetEnabled(!this.options.disabled),this._imMask.SetReadOnly(!!this.options.disableUserInput),this._imMask.SetExitOnLastChar(!!this.options.blurOnLastChar),this._imMask.SetImeMode(this.options.imeMode),this._imMask.SetExitOnLeftRightKey(this._convertExistOnLeftRightKey(this.options.blurOnLeftRightKey)),this._imMask.SetTabAction(this._convertTabAction(this.options.tabAction)),this._imMask.SetDisplayNull(this.options.nullText),this._imMask.SetHideEnter(!!this.options.hideEnter),this._imMask.SetPromptChar(this.options.promptChar),this._imMask.SetAutoConvert(!!this.options.autoConvert),this._imMask.SetHidePromptOnLeave(!!this.options.hidePromptOnLeave),this._imMask.SetHighlightText(this._convertHighlightText(this.options.highlightText))},r.prototype._convertExistOnLeftRightKey=function(t){t||(t="none"),t=t.toLowerCase();if(t==="none")return e.ExitOnLeftRightKey.None;if(t==="left")return e.ExitOnLeftRightKey.Left;if(t==="right")return e.ExitOnLeftRightKey.Right;if(t==="both")return e.ExitOnLeftRightKey.Both},r.prototype._convertHighlightText=function(t){return t?(t=t.toLowerCase(),t==="field"?e.HighlightText.Field:t==="all"?e.HighlightText.All:e.HighlightText.None):e.HighlightText.None},r.prototype._convertTabAction=function(t){return t||(t="control"),t=t.toLowerCase(),t==="control"?e.TabAction.Control:e.TabAction.Field},r.prototype._addimMaskCustomEvent=function(){var e=this;this._imMask.OnInvalidInput(function(t){e._fireIvalidInputEvent("")}),this._imMask.OnTextChanged(function(t){e._raiseTextChanged()}),this._imMask.OnEditingTextChanged(function(t){e._updateText(!0)}),this._imMask.OnKeyExit(function(t){e._trigger("keyExit")})},r.prototype._processClearButton=function(){this._textProvider.clear(new e.wijInputResult),this._updateText();var t=this._textProvider.findEditPositionFrom(0,!0);this.selectText(t,t)},r.prototype._resetData=function(){var e=this.element.data("defaultText");if(e===undefined||e===null)e=this.element.data("elementValue");if(e===undefined||e===null)e="";this.setText(e)},r.prototype._isPassword=function(){return!!this.element.data("isPassword")},r.prototype._getTextWithPrompts=function(){return this._isInitialized()?this._textProvider.toString(!0,!0,!1):this.element.val()},r.prototype._getTextWithLiterals=function(){return this._isInitialized()?this._textProvider.toString(!0,!1,!0):this.element.val()},r.prototype._getTextWithPromptAndLiterals=function(){return this._isInitialized()?this._textProvider.toString(!0,!0,!0):this.element.val()},r.prototype._getTextWithPromptAndLiteralsAndPassword=function(){return this._isInitialized()?this._textProvider.toString(!1,!0,!0):this.element.val()},r.prototype._onChange=function(){if(!this.element)return;var e=this.element.val();this.getText()!==e&&this._getTextWithPrompts()!==e&&this._getTextWithPromptAndLiterals()!==e&&(this._textProvider.getPasswordChar()!==""?this._getTextWithPromptAndLiteralsAndPassword()!==e&&this.setText(e):this.setText(e))},r.prototype._afterFocused=function(){(this._isNullText()||!!this.options.hidePromptOnLeave)&&this._doFocus();if(this.options.highlightText==="field"){var e=this._getCurrentField(),t=e.currentField,n=e.fieldList;t>=n.length&&(t=n.length-1);var r=n[t];r&&this.selectText(r.start,r.end+1)}else this.options.highlightText==="all"&&this.selectText(0,this.element.get(0).value.length)},r.prototype._processTabKey=function(e){var t=this,n=this.options.tabAction;return n=n?n.toLowerCase():"control",n==="control"?(setTimeout(function(){t._trigger("keyExit")},0),!1):this._moveField(!e.shiftKey)},r.prototype._getCurrentField=function(){var e=this._textProvider._getFieldList(),t=this.element.wijtextselection(),n=t.start,r=-1;e.length>0&&n>e[e.length-1].end&&(r=e.length);if(r===-1)for(var i=0;i<e.length;i++){if(n>=e[i].start&&n<=e[i].end){r=i;break}if(n<e[i].start){i!=0?r=i:r=-1;break}}var s={};return s.currentField=r,s.fieldList=e,s},r.prototype._moveField=function(e){var t=this._getCurrentField(),n=t.currentField,r=t.fieldList;if(e){if(n===r.length-1)return!1;this.element.wijtextselection(r[n+1].start,r[n+1].start)}else{if(n<=0)return!1;this.element.wijtextselection(r[n-1].start,r[n-1].start)}return!0},r.prototype._processLeftRightKey=function(e){var t=this.element.wijtextselection(),n=this.options.blurOnLeftRightKey?this.options.blurOnLeftRightKey.toLowerCase():"none";if(e&&t.start===0){if(n==="both"||n==="left")return this._moveControl(this.element.get(0),!1,!0),!0}else{var r=n==="both"||n==="right",i=!1;this._textProvider.noMask&&t.start===this.options.text.length?i=!0:!this._textProvider.noMask&&t.start===this._textProvider.testString.length&&(i=!0);if(!e&&r&&i)return this._moveControl(this.element.get(0),!0,!0),!0}return!1},r.prototype._onKeyPress=function(e){if(!this._textProvider.noMask&&this.options.blurOnLastChar)var t=this._textProvider._isLastCharAssigned();n.prototype._onKeyPress.call(this,e);if(!this._textProvider.noMask&&this.options.blurOnLastChar){var r=this._textProvider._isLastCharAssigned();!t&&r&&this._moveControl(this.element.get(0),!0,!0)}},r.prototype.setText=function(e){if(e===undefined)return;this._advanceMode?e==this.options.textWithPromptAndLiterals?(this.options.textWithPromptAndLiterals=undefined,this._imMask.SetText(e)):this._imMask.SetValue(e):n.prototype.setText.call(this,e)},r.prototype.getText=function(){return this._advanceMode?this._imMask.GetTextOnSimpleMode():n.prototype.getText.call(this)},r.prototype.selectText=function(e,t){typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=this.getText().length),isNaN(e)&&(e=0),isNaN(t)&&(t=0),this._advanceMode?(this._imMask.SetSelectionStart(e),this._imMask.SetSelectionLength(Math.abs(t-e)),this._imMask.SetFocus()):n.prototype.selectText.call(this,e,t)},r.prototype.getSelectedText=function(){return this._advanceMode?this._imMask.GetSelectedText():n.prototype.getSelectedText.call(this)},r.prototype._attachInputEvent=function(){this._advanceMode?this._imMask.AttachInput(this.element.get(0)):n.prototype._attachInputEvent.call(this)},r.prototype._detachInputEvent=function(){this._advanceMode?this._imMask.DetachInput():n.prototype._detachInputEvent.call(this)},r.prototype.getPostValue=function(){return this._advanceMode?this._imMask.GetPostValueOnSimpleMode():n.prototype.getPostValue.call(this)},r.prototype._initialize=function(){this.options.maskFormat&&(this.options.mask=this.options.maskFormat),n.prototype._initialize.call(this)},r.prototype._init=function(){n.prototype._init.call(this);var e=this.options.text||this.element.val();this.options.mask&&this._setOption("mask",this.options.mask),e&&e!==this._getNullText()&&this._setOption("text",e)},r.prototype._updateText=function(e){typeof e=="undefined"&&(e=!1);if(!this.element.data("initialized"))if(this.options.mask instanceof RegExp||this.options.formatMode==="advanced")return;if(this._advanceMode){if(!this._isInitialized())return;if(this.element.is(":disabled"))return;var t=this._imMask.GetTextOnSimpleMode();this.options.advancedText=this._imMask.GetText(),t!==this.options.text&&(this.options.text=t,this._raiseTextChanged())}else n.prototype._updateText.call(this,e)},r.prototype.isFocused=function(){return this._advanceMode?this._imMask.IsFocused():n.prototype.isFocused.call(this)},r.prototype._getAllowPromptAsInput=function(){return this.options.allowPromptAsInput},r.prototype._getPasswordChar=function(){return this.options.passwordChar},r.prototype._getResetOnPrompt=function(){return this.options.resetOnPrompt},r.prototype._getResetOnSpace=function(){return this.options.resetOnSpace},r.prototype._getSkipLiterals=function(){return this.options.skipLiterals},r.prototype._getHidePromptOnLeave=function(){return this.options.hidePromptOnLeave},r.prototype._getPromptChar=function(){return this.options.promptChar},r.prototype._getAutoConvert=function(){return this.options.autoConvert},r.prototype._getNullText=function(){return this.options.nullText},r}(e.wijinputcore);e.wijinputmask=n;var r=function(){function t(){this.wijCSS={wijinputmask:e.wijinputcore.prototype.options.wijCSS.wijinput+"-mask"},this.autoConvert=!0,this.text=null,this.highlightText="none",this.mask="",this.maskFormat="",this.promptChar="_",this.hidePromptOnLeave=!1,this.resetOnPrompt=!0,this.allowPromptAsInput=!1,this.passwordChar="",this.resetOnSpace=!0,this.skipLiterals=!0,this.blurOnLastChar=!1,this.tabAction="control",this.imeMode="auto",this.allowSpinLoop=!1,this.spinnerAlign="verticalRight",this.showSpinner=!1}return t}();n.prototype.options=t.extend(!0,{},e.wijinputcore.prototype.options,new r),t.wijmo.registerWidget("wijinputmask",n.prototype)})(e.input||(e.input={}));var t=e.input})(wijmo||(wijmo={}));