/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define("jquery-nos-inspector-date",["jquery-nos-listgrid","jquery-nos-renderer-datetimepicker"],function(a){a.fn.extend({nosInspectorDate:function(b){b=b||{texts:{"from begin to end":"from {{begin}} to {{end}}","until end":"until {{end}}","since begin":"since {{begin}}"},content:{}};return this.each(function(){var c=a(this).removeAttr("id").css({display:"inline-block"}).hide(),g=a("<table></table>").insertAfter(c),e=g.parent().bind({widgetResize:function(){c.appendTo(e);g.noslistgrid("setSize",e.width(),e.height())}}),d=e.data("inspector"),f=c.find(":input[type=text]").each(function(){var i=a(this).datepicker("option","onSelect");a(this).datepicker("option","onSelect",function(p,r){if(a.isFunction(i)){i.call(this,p,r)}var o=this===c.find(":input:first")[0]?"minDate":"maxDate",k=c.find(":text:first").val(),m=c.find(":text:last").val(),n=c.find(":input[type=hidden]:first").val(),j=c.find(":input[type=hidden]:last").val(),q;var l=a.datepicker.parseDate(r.settings.dateFormat||a.datepicker._defaults.dateFormat,p,r.settings);f.not(this).datepicker("option",o,l);if(k||m){if(k&&m){q=a.nosDataReplace(b.texts["from begin to end"],{begin:k,end:m})}else{if(!k){q=a.nosDataReplace(b.texts["until end"],{end:m})}}if(!m){q=a.nosDataReplace(b.texts["since begin"],{begin:k})}if(a.isFunction(d.selectionChanged)){d.selectionChanged(n+"|"+j,q)}}})}),h=false;g.css({height:"100%",width:"100%"}).noslistgrid({columnsAutogenerationMode:"none",scrollMode:"auto",showGroupArea:false,columns:[{dataKey:"group",groupInfo:{groupSingleRow:false,position:"header",outlineMode:"startCollapsed",headerText:"<b>{0}</b>"},visible:false},{headerText:d.label,cellFormatter:function(i){if(a.isPlainObject(i.row.data)&&i.row.data.value==="custom"){i.$container.css({"white-space":"normal","padding-left":"10px"});a("<span></span>").text(i.row.data.title).css({"white-space":"nowrap","margin-right":"10px"}).appendTo(i.$container);c.appendTo(i.$container);return true}else{i.$container.css("padding-left","30px")}},dataKey:"title"},{visible:false}],data:b.content,noCellsSelected:true,currentCellChanged:function(j){var k=a(j.target).noslistgrid("currentCell").row(),i=k?k.data:false;if(i&&h){if(i.value!=="custom"){c.hide()}if(i.value==="custom"){c.show()}else{d.selectionChanged(i.value,i.title)}}g.noslistgrid("currentCell",-1,-1)},rendering:function(){h=false},rendered:function(){h=true;g.css("height","auto")}})})}});return a});