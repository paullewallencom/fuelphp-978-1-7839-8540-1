/**
 * NOVIUS OS - Web OS for digital communication
 *
 * @copyright  2011 Novius
 * @license    GNU Affero General Public License v3 or (at your option) any later version
 *             http://www.gnu.org/licenses/agpl-3.0.html
 * @link http://www.novius-os.org
 */
define(["jquery-nos"],function(a){return function(d){d=a.extend({form_id:"",tpvar_id:"",texts:{deletePanel:"Delete",managePanel:"Manage",editPanelName:"Edit name"}},d);var e=a("#"+d.form_id+" .nos-fixed-content");var b=e.closest(".nos-dispatcher, body");var c=e.find("> div:last");e.nosOnShow("one",function(){var g=a('<div class="template-e-iframe"></div>').appendTo(e).css("top",c.position().top+"px");var f=b.find("select[name=tpvar_template]");a('<iframe src="admin/noviusos_template_bootstrap/visualise?context='+b.data("nosContext")+"&template="+f.val()+"&tpvar_id="+(d.tpvar_id?d.tpvar_id:"")+"&dom_id="+d.form_id+'"></iframe>').appendTo(g)});e.find('[class*="template-e-side-"]').nosOnShow("one",function(){var g=a(this);var f;var i="";var h=a('<ul class="template-e-ul_sort"></ul>');g.find("tr").each(function(){var j=a(this);if(j.has("td :checkbox").length){var k=a("<li></li>").html(j.find("td").html()+j.find("th").html()).appendTo(h);a('<button data-icon="trash"></button>').addClass("btn_suppr_panel").attr("type","button").attr("data-input",j.find("td input").attr("name")).attr("data-icon","trash").attr("data-text","false").text(d.texts.deletePanel).appendTo(k);a("<button></button>").addClass("btn_config_panel").attr("type","button").attr("data-block",j.find("td input").data("target")).attr("data-icon","gear").attr("data-text","false").text(d.texts.managePanel).appendTo(k);if(j.has("td :checkbox[name*='panel']").length){a("<button></button>").addClass("btn_write_panel").attr("type","button").attr("data-input",j.find("td input").attr("name")).attr("data-icon","pencil").attr("data-text","false").text(d.texts.editPanelName).appendTo(k)}}else{i=j.find("td").html()+j.find("th").html()}});f=g.find("input[type=hidden]").get(0).outerHTML;g.empty().append(h).append(i).append(f).nosFormUI();g.find("li").addClass("ui-widget-content ui-helper-clearfix").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})})}});